{"ast":null,"code":"import axios from 'axios';\nconst API_URL = 'http://localhost:8000/api';\n\n// Настраиваем axios для всех запросов\nexport const axiosInstance = axios.create({\n  baseURL: API_URL,\n  withCredentials: false,\n  headers: {\n    'Content-Type': 'application/json',\n    'Accept': 'application/json'\n  }\n});\nexport default {\n  namespaced: true,\n  state: {\n    isAuthenticated: false,\n    user: null,\n    userId: null,\n    token: null,\n    error: null\n  },\n  mutations: {\n    SET_AUTH(state, auth) {\n      state.isAuthenticated = auth.isAuthenticated;\n      state.user = auth.user;\n      state.userId = auth.userId;\n      state.token = auth.token;\n    },\n    SET_ERROR(state, error) {\n      state.error = error;\n    },\n    CLEAR_ERROR(state) {\n      state.error = null;\n    }\n  },\n  actions: {\n    async register({\n      commit\n    }, userData) {\n      try {\n        commit('CLEAR_ERROR');\n        const response = await axiosInstance.post('/register', {\n          username: userData.username,\n          email: userData.email,\n          password: userData.password\n        });\n        console.log('Registration successful:', response.data);\n        return response.data;\n      } catch (error) {\n        console.error('Registration error:', error);\n        let errorMessage = 'Ошибка при регистрации';\n        if (error.response) {\n          errorMessage = error.response.data.detail || errorMessage;\n        }\n        commit('SET_ERROR', errorMessage);\n        throw new Error(errorMessage);\n      }\n    },\n    async login({\n      commit\n    }, credentials) {\n      try {\n        commit('CLEAR_ERROR');\n        const formData = new FormData();\n        formData.append('username', credentials.username);\n        formData.append('password', credentials.password);\n        const response = await axiosInstance.post('/login', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n        const {\n          access_token,\n          username,\n          user_id\n        } = response.data;\n        commit('SET_AUTH', {\n          isAuthenticated: true,\n          user: username,\n          userId: user_id,\n          token: access_token\n        });\n        localStorage.setItem('token', access_token);\n        localStorage.setItem('userId', user_id);\n        axiosInstance.defaults.headers.common['Authorization'] = `Bearer ${access_token}`;\n        return response.data;\n      } catch (error) {\n        console.error('Login error:', error);\n        let errorMessage = 'Ошибка при входе';\n        if (error.response) {\n          errorMessage = error.response.data.detail || errorMessage;\n        }\n        commit('SET_ERROR', errorMessage);\n        throw new Error(errorMessage);\n      }\n    },\n    logout({\n      commit\n    }) {\n      localStorage.removeItem('token');\n      localStorage.removeItem('userId');\n      delete axiosInstance.defaults.headers.common['Authorization'];\n      commit('SET_AUTH', {\n        isAuthenticated: false,\n        user: null,\n        userId: null,\n        token: null\n      });\n    }\n  },\n  getters: {\n    isAuthenticated: state => state.isAuthenticated,\n    currentUser: state => state.user,\n    authError: state => state.error\n  }\n};","map":{"version":3,"names":["axios","API_URL","axiosInstance","create","baseURL","withCredentials","headers","namespaced","state","isAuthenticated","user","userId","token","error","mutations","SET_AUTH","auth","SET_ERROR","CLEAR_ERROR","actions","register","commit","userData","response","post","username","email","password","console","log","data","errorMessage","detail","Error","login","credentials","formData","FormData","append","access_token","user_id","localStorage","setItem","defaults","common","logout","removeItem","getters","currentUser","authError"],"sources":["/home/dotcore/ichat/frontend/src/store/modules/auth.js"],"sourcesContent":["import axios from 'axios'\n\nconst API_URL = 'http://localhost:8000/api'\n\n// Настраиваем axios для всех запросов\nexport const axiosInstance = axios.create({\n  baseURL: API_URL,\n  withCredentials: false,\n  headers: {\n    'Content-Type': 'application/json',\n    'Accept': 'application/json'\n  }\n})\n\nexport default {\n  namespaced: true,\n  \n  state: {\n    isAuthenticated: false,\n    user: null,\n    userId: null,\n    token: null,\n    error: null\n  },\n\n  mutations: {\n    SET_AUTH(state, auth) {\n      state.isAuthenticated = auth.isAuthenticated\n      state.user = auth.user\n      state.userId = auth.userId\n      state.token = auth.token\n    },\n    SET_ERROR(state, error) {\n      state.error = error\n    },\n    CLEAR_ERROR(state) {\n      state.error = null\n    }\n  },\n\n  actions: {\n    async register({ commit }, userData) {\n      try {\n        commit('CLEAR_ERROR')\n        const response = await axiosInstance.post('/register', {\n          username: userData.username,\n          email: userData.email,\n          password: userData.password\n        })\n        \n        console.log('Registration successful:', response.data)\n        return response.data\n      } catch (error) {\n        console.error('Registration error:', error)\n        let errorMessage = 'Ошибка при регистрации'\n        if (error.response) {\n          errorMessage = error.response.data.detail || errorMessage\n        }\n        commit('SET_ERROR', errorMessage)\n        throw new Error(errorMessage)\n      }\n    },\n\n    async login({ commit }, credentials) {\n      try {\n        commit('CLEAR_ERROR')\n        const formData = new FormData()\n        formData.append('username', credentials.username)\n        formData.append('password', credentials.password)\n\n        const response = await axiosInstance.post('/login', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        })\n        \n        const { access_token, username, user_id } = response.data\n        \n        commit('SET_AUTH', {\n          isAuthenticated: true,\n          user: username,\n          userId: user_id,\n          token: access_token\n        })\n        \n        localStorage.setItem('token', access_token)\n        localStorage.setItem('userId', user_id)\n        axiosInstance.defaults.headers.common['Authorization'] = `Bearer ${access_token}`\n        \n        return response.data\n      } catch (error) {\n        console.error('Login error:', error)\n        let errorMessage = 'Ошибка при входе'\n        if (error.response) {\n          errorMessage = error.response.data.detail || errorMessage\n        }\n        commit('SET_ERROR', errorMessage)\n        throw new Error(errorMessage)\n      }\n    },\n\n    logout({ commit }) {\n      localStorage.removeItem('token')\n      localStorage.removeItem('userId')\n      delete axiosInstance.defaults.headers.common['Authorization']\n      commit('SET_AUTH', {\n        isAuthenticated: false,\n        user: null,\n        userId: null,\n        token: null\n      })\n    }\n  },\n\n  getters: {\n    isAuthenticated: state => state.isAuthenticated,\n    currentUser: state => state.user,\n    authError: state => state.error\n  }\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}