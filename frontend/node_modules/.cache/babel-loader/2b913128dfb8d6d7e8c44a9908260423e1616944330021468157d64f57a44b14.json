{"ast":null,"code":"import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, vModelText as _vModelText, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"profile-container\"\n};\nconst _hoisted_2 = {\n  class: \"profile-card\"\n};\nconst _hoisted_3 = {\n  class: \"avatar-section\"\n};\nconst _hoisted_4 = {\n  class: \"avatar\"\n};\nconst _hoisted_5 = [\"src\"];\nconst _hoisted_6 = {\n  class: \"profile-info\"\n};\nconst _hoisted_7 = {\n  class: \"info-group\"\n};\nconst _hoisted_8 = {\n  class: \"info-group\"\n};\nconst _hoisted_9 = {\n  class: \"password-section\"\n};\nconst _hoisted_10 = {\n  class: \"form-group\"\n};\nconst _hoisted_11 = {\n  class: \"form-group\"\n};\nconst _hoisted_12 = {\n  class: \"form-group\"\n};\nconst _hoisted_13 = [\"disabled\"];\nconst _hoisted_14 = {\n  key: 0,\n  class: \"error-message\"\n};\nconst _hoisted_15 = {\n  key: 1,\n  class: \"success-message\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"img\", {\n    src: $data.avatarUrl ? `http://localhost:8000${$data.avatarUrl}` : '/default-avatar.png',\n    alt: \"Аватар\"\n  }, null, 8 /* PROPS */, _hoisted_5), _createElementVNode(\"div\", {\n    class: \"avatar-overlay\",\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.triggerFileInput && $options.triggerFileInput(...args))\n  }, _cache[6] || (_cache[6] = [_createElementVNode(\"span\", null, \"Изменить фото\", -1 /* HOISTED */)]))]), _createElementVNode(\"input\", {\n    type: \"file\",\n    ref: \"fileInput\",\n    style: {\n      \"display\": \"none\"\n    },\n    accept: \"image/*\",\n    onChange: _cache[1] || (_cache[1] = (...args) => $options.handleAvatarUpload && $options.handleAvatarUpload(...args))\n  }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)]), _createElementVNode(\"div\", _hoisted_6, [_cache[13] || (_cache[13] = _createElementVNode(\"h2\", null, \"Профиль пользователя\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_7, [_cache[7] || (_cache[7] = _createElementVNode(\"label\", null, \"Логин:\", -1 /* HOISTED */)), _createElementVNode(\"span\", null, _toDisplayString($data.userInfo.username), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_8, [_cache[8] || (_cache[8] = _createElementVNode(\"label\", null, \"E-mail:\", -1 /* HOISTED */)), _createElementVNode(\"span\", null, _toDisplayString($data.userInfo.email), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_9, [_cache[12] || (_cache[12] = _createElementVNode(\"h3\", null, \"Изменить пароль\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_10, [_cache[9] || (_cache[9] = _createElementVNode(\"label\", null, \"Текущий пароль:\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"password\",\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.passwordForm.currentPassword = $event),\n    placeholder: \"Введите текущий пароль\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.passwordForm.currentPassword]])]), _createElementVNode(\"div\", _hoisted_11, [_cache[10] || (_cache[10] = _createElementVNode(\"label\", null, \"Новый пароль:\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"password\",\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $data.passwordForm.newPassword = $event),\n    placeholder: \"Введите новый пароль\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.passwordForm.newPassword]])]), _createElementVNode(\"div\", _hoisted_12, [_cache[11] || (_cache[11] = _createElementVNode(\"label\", null, \"Подтверждение пароля:\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"password\",\n    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => $data.passwordForm.confirmPassword = $event),\n    placeholder: \"Подтвердите новый пароль\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.passwordForm.confirmPassword]])]), _createElementVNode(\"button\", {\n    onClick: _cache[5] || (_cache[5] = (...args) => $options.changePassword && $options.changePassword(...args)),\n    disabled: $data.loading\n  }, _toDisplayString($data.loading ? 'Сохранение...' : 'Изменить пароль'), 9 /* TEXT, PROPS */, _hoisted_13)]), $data.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_14, _toDisplayString($data.error), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), $data.success ? (_openBlock(), _createElementBlock(\"div\", _hoisted_15, _toDisplayString($data.success), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)])])]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","src","$data","avatarUrl","alt","_hoisted_5","onClick","_cache","args","$options","triggerFileInput","type","ref","style","accept","onChange","handleAvatarUpload","_hoisted_6","_hoisted_7","_toDisplayString","userInfo","username","_hoisted_8","email","_hoisted_9","_hoisted_10","$event","passwordForm","currentPassword","placeholder","_hoisted_11","newPassword","_hoisted_12","confirmPassword","changePassword","disabled","loading","_hoisted_13","error","_hoisted_14","_createCommentVNode","success","_hoisted_15"],"sources":["/home/dotcore/ichat/frontend/src/components/Profile.vue"],"sourcesContent":["<template>\n  <div class=\"profile-container\">\n    <div class=\"profile-card\">\n      <div class=\"avatar-section\">\n        <div class=\"avatar\">\n          <img \n            :src=\"avatarUrl ? `http://localhost:8000${avatarUrl}` : '/default-avatar.png'\" \n            alt=\"Аватар\"\n          >\n          <div class=\"avatar-overlay\" @click=\"triggerFileInput\">\n            <span>Изменить фото</span>\n          </div>\n        </div>\n        <input\n          type=\"file\"\n          ref=\"fileInput\"\n          style=\"display: none\"\n          accept=\"image/*\"\n          @change=\"handleAvatarUpload\"\n        >\n      </div>\n\n      <div class=\"profile-info\">\n        <h2>Профиль пользователя</h2>\n        \n        <div class=\"info-group\">\n          <label>Логин:</label>\n          <span>{{ userInfo.username }}</span>\n        </div>\n\n        <div class=\"info-group\">\n          <label>E-mail:</label>\n          <span>{{ userInfo.email }}</span>\n        </div>\n\n        <div class=\"password-section\">\n          <h3>Изменить пароль</h3>\n          <div class=\"form-group\">\n            <label>Текущий пароль:</label>\n            <input \n              type=\"password\" \n              v-model=\"passwordForm.currentPassword\"\n              placeholder=\"Введите текущий пароль\"\n            >\n          </div>\n          <div class=\"form-group\">\n            <label>Новый пароль:</label>\n            <input \n              type=\"password\" \n              v-model=\"passwordForm.newPassword\"\n              placeholder=\"Введите новый пароль\"\n            >\n          </div>\n          <div class=\"form-group\">\n            <label>Подтверждение пароля:</label>\n            <input \n              type=\"password\" \n              v-model=\"passwordForm.confirmPassword\"\n              placeholder=\"Подтвердите новый пароль\"\n            >\n          </div>\n          <button @click=\"changePassword\" :disabled=\"loading\">\n            {{ loading ? 'Сохранение...' : 'Изменить пароль' }}\n          </button>\n        </div>\n\n        <div v-if=\"error\" class=\"error-message\">\n          {{ error }}\n        </div>\n        <div v-if=\"success\" class=\"success-message\">\n          {{ success }}\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { axiosInstance } from '../store/modules/auth'\n\nexport default {\n  name: 'Profile',\n  data() {\n    return {\n      userInfo: {\n        username: '',\n        email: '',\n        avatar: null\n      },\n      passwordForm: {\n        currentPassword: '',\n        newPassword: '',\n        confirmPassword: ''\n      },\n      loading: false,\n      error: null,\n      success: null,\n      avatarUrl: null\n    }\n  },\n  async created() {\n    await this.loadUserInfo()\n  },\n  methods: {\n    async loadUserInfo() {\n      try {\n        const response = await axiosInstance.get(`/users/${this.$store.state.auth.userId}`)\n        this.userInfo = response.data\n        this.avatarUrl = response.data.avatar_url\n      } catch (error) {\n        console.error('Error loading user info:', error)\n        this.error = 'Ошибка при загрузке информации пользователя'\n      }\n    },\n    \n    triggerFileInput() {\n      this.$refs.fileInput.click()\n    },\n    \n    async handleAvatarUpload(event) {\n      const file = event.target.files[0]\n      if (!file) return\n      \n      const formData = new FormData()\n      formData.append('avatar', file)\n      \n      try {\n        this.loading = true\n        const response = await axiosInstance.post(`/users/${this.$store.state.auth.userId}/avatar`, formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        })\n        this.avatarUrl = response.data.avatar_url\n        this.success = 'Аватар успешно обновлен'\n        \n        setTimeout(() => {\n          const img = new Image()\n          img.src = `http://localhost:8000${this.avatarUrl}?${new Date().getTime()}`\n        }, 100)\n      } catch (error) {\n        console.error('Error uploading avatar:', error)\n        this.error = 'Ошибка при загрузке аватара'\n      } finally {\n        this.loading = false\n      }\n    },\n    \n    async changePassword() {\n      if (this.passwordForm.newPassword !== this.passwordForm.confirmPassword) {\n        this.error = 'Пароли не совпадают'\n        return\n      }\n      \n      try {\n        this.loading = true\n        await axiosInstance.post(`/users/${this.$store.state.auth.userId}/change-password`, {\n          current_password: this.passwordForm.currentPassword,\n          new_password: this.passwordForm.newPassword\n        })\n        \n        this.success = 'Пароль успешно изменен'\n        this.passwordForm = {\n          currentPassword: '',\n          newPassword: '',\n          confirmPassword: ''\n        }\n        this.error = null\n      } catch (error) {\n        console.error('Error changing password:', error)\n        if (error.response?.status === 401) {\n          this.error = 'Неверный текущий пароль'\n        } else {\n          this.error = 'Ошибка при изменении пароля'\n        }\n      } finally {\n        this.loading = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.profile-container {\n  padding: 20px;\n  max-width: 800px;\n  margin: 0 auto;\n}\n\n.profile-card {\n  background: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  padding: 30px;\n  display: flex;\n  gap: 40px;\n}\n\n.avatar-section {\n  flex-shrink: 0;\n}\n\n.avatar {\n  width: 200px;\n  height: 200px;\n  border-radius: 50%;\n  overflow: hidden;\n  position: relative;\n  cursor: pointer;\n}\n\n.avatar img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.avatar-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0;\n  transition: opacity 0.3s;\n}\n\n.avatar-overlay span {\n  color: white;\n  font-size: 14px;\n}\n\n.avatar:hover .avatar-overlay {\n  opacity: 1;\n}\n\n.profile-info {\n  flex-grow: 1;\n}\n\n.info-group {\n  margin-bottom: 20px;\n}\n\n.info-group label {\n  display: block;\n  color: #666;\n  margin-bottom: 5px;\n}\n\n.info-group span {\n  font-size: 16px;\n  color: #333;\n}\n\n.password-section {\n  margin-top: 30px;\n  padding-top: 20px;\n  border-top: 1px solid #eee;\n}\n\n.form-group {\n  margin-bottom: 15px;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 5px;\n  color: #666;\n}\n\ninput {\n  width: 100%;\n  padding: 8px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  font-size: 14px;\n}\n\nbutton {\n  background: #42b983;\n  color: white;\n  border: none;\n  padding: 10px 20px;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 14px;\n}\n\nbutton:disabled {\n  background: #ccc;\n  cursor: not-allowed;\n}\n\n.error-message {\n  margin-top: 20px;\n  padding: 10px;\n  background: #ffe6e6;\n  color: #ff4444;\n  border-radius: 4px;\n}\n\n.success-message {\n  margin-top: 20px;\n  padding: 10px;\n  background: #e6ffe6;\n  color: #42b983;\n  border-radius: 4px;\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}